
install_targets = \
	install-data-local \
	install-headers \
	install-build \
	install-programs

include $(top_srcdir)/build/rules.mk

peardir=$(PEAR_INSTALLDIR)

PEAR_SUBDIRS = \
	DB \
	File \
	Net \
	PEAR

PEAR_FILES = \
	DB.php \
	DB/common.php \
	DB/odbc.php \
	DB/mysql.php \
	DB/mssql.php \
	DB/pgsql.php \
	DB/storage.php \
	DB/oci8.php \
	HTTP.php \
	File/Find.php \
	Net/Socket.php \
	PEAR.php \
	PEAR/Installer.php

install-data-local: PEAR.php
	@if $(mkinstalldirs) $(peardir); then \
		for i in $(PEAR_SUBDIRS); do \
			$(mkinstalldirs) $(peardir)/$$i; \
		done; \
		for i in $(PEAR_FILES); do \
			dir=`echo $$i|sed 's%[^/][^/]*$$%%'`; \
			$(INSTALL_DATA) $(srcdir)/$$i $(peardir)/$$dir; \
		done; \
	else \
		cat $(srcdir)/install-pear.txt; \
		exit 5; \
	fi

phpincludedir = $(includedir)/php
phpbuilddir = $(prefix)/lib/php/build

BUILD_FILES = \
	pear/pear.m4 \
	build/fastgen.sh \
	build/library.mk \
	build/ltlib.mk \
	build/program.mk \
	build/rules.mk \
	build/rules_common.mk \
	build/rules_pear.mk \
	build/dynlib.mk \
	build/shtool \
	dynlib.m4 \
	acinclude.m4

bin_PROGRAMS = phpize php-config pear

install-build:
	$(mkinstalldirs) $(phpbuilddir) $(bindir) && \
	(cd $(top_srcdir) && cp $(BUILD_FILES) $(phpbuilddir))

install-programs:
	$(INSTALL) -m 755 $(srcdir)/phpextdist $(bindir)/phpextdist
	for prog in $(bin_PROGRAMS); do \
		$(INSTALL) -m 755 $$prog $(bindir)/$$prog; \
	done

HEADER_DIRS = \
	/ \
	Zend \
	TSRM \
	ext/standard \
	ext/xml \
	ext/xml/expat/xmlparse \
	ext/xml/expat/xmltok \
	main \
	regex

install-headers:
	-@for i in $(HEADER_DIRS); do \
		paths="$$paths $(phpincludedir)/$$i"; \
	done; \
	$(mkinstalldirs) $$paths && \
	echo "creating header file hierarchy" && \
	for i in $(HEADER_DIRS); do \
		(cd $(top_srcdir)/$$i && cp -p *.h $(phpincludedir)/$$i; \
		cd $(top_builddir)/$$i && cp -p *.h $(phpincludedir)/$$i) 2>/dev/null || true; \
	done

test: run-tests Makefile
	@./run-tests

Makefile: Makefile.in $(top_builddir)/config.status
	(cd ..;CONFIG_FILES=pear/Makefile CONFIG_HEADERS= $(top_builddir)/config.status)

run-tests: run-tests.in $(top_builddir)/config.status
	(cd ..;CONFIG_FILES=pear/$@ CONFIG_HEADERS= $(top_builddir)/config.status)
	chmod +x $@

pear: pear.in $(top_builddir)/config.status
	(cd ..;CONFIG_FILES=pear/pear CONFIG_HEADERS= $(top_builddir)/config.status)

phpize: phpize.in $(top_builddir)/config.status
	(cd ..;CONFIG_FILES=pear/phpize CONFIG_HEADERS= $(top_builddir)/config.status)

php-config: php-config.in $(top_builddir)/config.status
	(cd ..;CONFIG_FILES=pear/php-config CONFIG_HEADERS= $(top_builddir)/config.status)

PEAR.php: PEAR.php.in $(top_builddir)/config.status
	(cd ..;CONFIG_FILES=pear/PEAR.php CONFIG_HEADERS= $(top_builddir)/config.status)
