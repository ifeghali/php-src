#!/bin/sh

if test "$1" = "--copy"; then
  automake_flags=--copy
fi

test -d libzend || ln -s ../libzend .
test -d TSRM || ln -s ../TSRM .

./scripts/preconfig

mv aclocal.m4 aclocal.m4.old 2>/dev/null
aclocal
if cmp aclocal.m4.old aclocal.m4 > /dev/null 2>&1; then
    echo keeping aclocal.m4
    mv aclocal.m4.old aclocal.m4
else
    echo created or modified aclocal.m4
fi

autoheader

automake --add-missing --include-deps $automake_flags

mv configure configure.old 2>/dev/null
autoconf
if cmp configure.old configure > /dev/null 2>&1; then
    echo keeping configure
    mv configure.old configure
else
    echo created or modified configure
fi

(cd libzend; ./buildconf libzend/)
(cd TSRM; ./buildconf TSRM/)
