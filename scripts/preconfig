#!/bin/sh
#
# $Id$

disclaimer="Do NOT edit - this file is generated by preconfig"

# security check - simply overwriting existing files could be harmful
if test -w configure.in.new || test -w acconfig.h.new ; then
	echo "Please remove the *.new files and rerun this command"
	exit 1
fi

makefiles=`echo ext/*/Makefile.am | sed -e 's/\.am//g'`
echo "dnl $disclaimer" > configure.in.new
sed -e "s#@@EXT_MAKEFILES@@#$makefiles#" configure.in.in >> configure.in.new
cmp configure.in configure.in.new > /dev/null 2>&1
if test $? -ne 0 ; then
    mv configure.in.new configure.in
else
    rm -f configure.in.new
fi

echo "/* $disclaimer */" > acconfig.h.new
cat acconfig.h.in >> acconfig.h.new
confighfiles=`echo ext/*/config.h.stub`
if test "$confighfiles" != "ext/*/config.h.stub"; then
    for file in $confighfiles; do
	cat $file >> acconfig.h.new
    done
fi
cmp acconfig.h acconfig.h.new > /dev/null 2>&1
if test $? -ne 0 ; then
    mv acconfig.h.new acconfig.h
else
    rm -f acconfig.h.new
fi
